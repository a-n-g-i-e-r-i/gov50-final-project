---
title: "Gov 50 Final Project"
author: "Tristan Angieri"
description: "Psychedelic Research Project"
output:
  distill::distill_article:
    self_contained: false
---



## Project thoughts

I am interested in exploring (a) research question(s) related to the human experience of psychedelics, particularly the affective and phenomenological effects. In terms of data sources, I believe the most likely ones may be Erowid.org, https://www.psychedelicdata.io/about%3FhsLang=en.html, or Fireside Project. My main concern is getting permission to use the data, and ensuring that it passes muster with the IRB.

## Proposal

### Research Question
How does the age of initiation and frequency of LSD use differ between urban and rural areas in the U.S. in 2021, and how does this relate to the recency of LSD use?

### Hypothesis
Individuals in urban areas might initiate LSD use at a younger age compared to those in rural areas due to increased exposure and accessibility. Furthermore, the frequency of LSD use in the past year and the recency of its use might be influenced by the age of initiation, with earlier initiation potentially leading to more frequent and recent use.

### Explanatory Variables of Interest:

#### Geographical Location (Rural vs. Urban):
Variable: RURURB00
Description: "RURAL OR URBAN SEGMENT"

#### Age of Initiation of LSD Use:
Variable: LSDAGE
Description: "AGE WHEN FIRST USED LSD"
Outcome Variables of Interest:

#### Frequency of LSD Use in the Past Year:
Variable: LSDYR
Description: "RC-LSD - PAST YEAR USE"

#### Recency of LSD Use:
Variable: LSDREC
Description: "TIME SINCE LAST USED LSD"

### Control Variables:

#### Ever Used LSD:
Variable: LSDFLAG
Description: "RC-LSD - EVER USED"

#### Age Last Used LSD:
Variable: LSDAGLST
Description: "HOW OLD WERE YOU THE LAST TIME USED LSD"
Expected Observations:

If the data reveals that individuals from urban areas initiate LSD use at a younger age and have a higher frequency of use in the past year compared to those from rural areas, it would support the hypothesis.

A significant positive relationship between the age of initiation (LSDAGE) and the recency of use (LSDREC) would suggest that earlier initiation leads to more recent use.

### Statistical Analysis
A regression analysis will be conducted with LSDYR and LSDREC as the dependent variables, and RURURB00 and LSDAGE as the main independent variables. The regression will control for ever using LSD and the age of last use. This will allow us to understand the relationship between the age of initiation, geographical location, and the frequency and recency of LSD use.

### Data Source
The data for this study will be sourced from the ["National Survey on Drug Use and Health 2021 (NSDUH-2021-DS0001)"](https://www.datafiles.samhsa.gov/dataset/national-survey-drug-use-and-health-2021-nsduh-2021-ds0001). The [dataset's specific variables](https://www.datafiles.samhsa.gov/sites/default/files/NSDUH_files/RDAS/RDAS_Comparability.xlsx) will provide a comprehensive perspective on the research question.

```{r}
library(dplyr)
nsduh <- load("./NSDUH_2021.RData")

#https://www.r-bloggers.com/2012/11/analyze-the-national-survey-on-drug-use-and-health-nsduh-with-r/
#http://asdfree.com/national-study-on-drug-use-and-health-nsduh.html
#https://github.com/ajdamico/lodown
# nsduh_tib <- as_tibble(nsduh)
# 
nsduh
```

```{r}
# PUF2021_100622
lsd_use <- PUF2021_100622 |>
  mutate(
    income_level = case_when(
      income == 1 ~ "Less than $20,000",
      income == 2 ~ "$20,000 - $49,999",
      income == 3 ~ "$50,000 - $74,999",
      income == 4 ~ "$75,000 or More"
    ),
    metro_level = case_when(
      COUTYP4 == 1 ~ "Large Metro",
      COUTYP4 == 2 ~ "Small Metro",
      COUTYP4 == 3 ~ "Non Metro"
    )
  ) |>
  # slice_sample(
  #   n = 10000
  # ) |>
  select(
    snfamjev,
    # income level
    income_level,
    # metro level
    metro_level,
    # respondent age
    AGE3,
    # imputation revised gender
    irsex,
    # population density
    PDEN10,
    # metro/non-metro
    COUTYP4,
    # age of first lsd age
    lsdage,
    # ever used lsd (1)
    lsdflag,
    # RC-POVERTY LEVEL (% OF US CENSUS POVERTY THRESHOLD)
    POVERTY3,
    # MY RELIGIOUS BELIEFS INFLUENCE MY DECISIONS (1 or 0)
    snrldcsn,
    # lsd age last use
    lsdaglst,
    # year of last lsd use
    lsdylu,
    # total family income
    income
  )
  # ) |>
  # filter(
  #   lsdflag == 1
  # )
```

```{r}
library(tidyverse)
```

```{r}
lsd_use_plot <- lsd_use |>
  filter(
    lsdage < 200
  ) |>
  ggplot(
    mapping = aes(
      x = lsdage
    )
  ) +
  geom_histogram(binwidth = 1) +
  geom_vline(aes(xintercept = mean(lsdage)), color = "indianred") +
  geom_vline(aes(xintercept = median(lsdage)), color = "dodgerblue") +
  labs(
    title = "Age of First LSD Use",
    x = "Age of respondent at first LSD use (years)",
    y = "Count"
  )

lsd_use_plot
```

```{r}
fit_1 <- lm(snfamjev ~ lsdflag , data = lsd_use)

fit_1 |>
  broom::tidy() |>
  select(term, estimate) |>  
  knitr::kable(digits = 2)
```

```{r}
fit_2 <- lm(snrldcsn ~ lsdflag, data = lsd_use)

fit_2 |>
  broom::tidy() |>
  select(term, estimate) |>  
  knitr::kable(digits = 2)
```

```{r}
metro_lsd_plot <- lsd_use |>
  group_by(metro_level) |>
  summarize(
    avg_lsdflag = mean(lsdflag)
  ) |>
  ggplot(mapping = aes(x = fct_reorder(metro_level, avg_lsdflag), y = avg_lsdflag, fill = metro_level)) +
  geom_col() +
  labs(
    title = "Metro level and ever used LSD",
    x = "Metro level family income",
    y = "Avergae proportion of respondents who have ever used LSD (%)"
  )

metro_lsd_plot
```

```{r}
income_lsd_plot <- lsd_use |>
  group_by(income_level) |>
  summarize(
    avg_lsdage = mean(lsdage),
    avg_lsdflag = mean(lsdflag)
  ) |>
  ggplot(mapping = aes(x = fct_reorder(income_level, avg_lsdflag), y = avg_lsdflag, fill = income_level)) +
  geom_col() +
  labs(
    title = "Income level and ever used LSD",
    x = "Total family income",
    y = "Avergae proportion of respondents who have ever used LSD (%)"
  )

income_lsd_plot
```

```{r}
# based on poverty level, avg lsd use flag?
income_lsd_age_plot <- lsd_use |>
  filter(
    lsdage < 200
  ) |>
  group_by(income_level) |>
  summarize(
    avg_lsdage = mean(lsdage)
  ) |>
  ggplot(mapping = aes(x = fct_reorder(income_level, avg_lsdage), y = avg_lsdage, fill = income_level)) +
  geom_col() +
  labs(
    title = "Income level and average age of first LSD use",
    x = "Total family income",
    y = "Avergae age of respondent when used LSD first (age)"
  )

income_lsd_age_plot
```


```{r}
metro_lsd_plot <- lsd_use |>
  filter(
    lsdage < 200
  ) |>
  group_by(metro_level) |>
  summarize(
    avg_lsdage = mean(lsdage)
  ) |>
  ggplot(mapping = aes(x = fct_reorder(metro_level, avg_lsdage), y = avg_lsdage, fill = metro_level)) +
  geom_col() +
  labs(
    title = "County metro/nonmetro status level and average age of first LSD use",
    x = "COUNTY METRO/NONMETRO STATUS (2013 3-LEVEL)",
    y = "Average Age of respondent at first LSD use (years)"
  )

metro_lsd_plot
```

